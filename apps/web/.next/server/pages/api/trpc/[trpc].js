"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3288:e=>{e.exports=import("@auth/prisma-adapter")},6206:e=>{e.exports=import("@t3-oss/env-nextjs")},2937:e=>{e.exports=import("@trpc/server")},6282:e=>{e.exports=import("@trpc/server/adapters/next")},3735:e=>{e.exports=import("next-auth")},9551:e=>{e.exports=import("next-auth/providers/discord")},3020:e=>{e.exports=import("superjson")},9926:e=>{e.exports=import("zod")},1040:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6010:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>d,routeModule:()=>l});var s=r(415),a=r(5637),o=r(1040),i=r(5652),c=e([i]);i=(c.then?(await c)():c)[0];let d=(0,o.l)(i,"default"),u=(0,o.l)(i,"config"),l=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/trpc/[trpc]",pathname:"/api/trpc/[trpc]",bundlePath:"",filename:""},userland:i});n()}catch(e){n(e)}})},5652:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>d});var s=r(6282),a=r(5386),o=r(2121),i=r(5115),c=e([s,a,o,i]);[s,a,o,i]=c.then?(await c)():c;let d=(0,s.createNextApiHandler)({router:o.q,createContext:i.uw,onError:"development"===a.O.NODE_ENV?({path:e,error:t})=>{console.error(`‚ùå tRPC failed on ${e??"<no-path>"}: ${t.message}`)}:void 0});n()}catch(e){n(e)}})},2121:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{q:()=>i});var s=r(5115),a=r(1555),o=e([s,a]);[s,a]=o.then?(await o)():o;let i=(0,s.hA)({healthz:a.F});n()}catch(e){n(e)}})},1555:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{F:()=>o});var s=r(5115),a=e([s]);s=(a.then?(await a)():a)[0];let o=(0,s.hA)({healthz:s.$y.query(()=>({status:"ok",timestamp:new Date().toISOString()}))});n()}catch(e){n(e)}})},5115:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{$y:()=>D,hA:()=>A,uw:()=>E});var s=r(2937),a=r(3020),o=r(9926),i=r(1001),c=r(105),d=r(6629),u=r(6336),l=e([s,a,o,i,c]);[s,a,o,i,c]=l.then?(await l)():l;let p=e=>({session:e.session,db:c.db,correlationId:e.correlationId,requestPath:e.requestPath}),E=async e=>{let{req:t,res:r}=e,n=await (0,i.WG)(),s=t.headers["x-correlation-id"]||`${Date.now()}-${Math.random().toString(36).substring(2,11)}`,a=t.url;return p({session:n,correlationId:s,requestPath:a})},m=s.initTRPC.context().create({transformer:a.default,errorFormatter:({shape:e,error:t})=>({...e,data:{...e.data,zodError:t.cause instanceof o.ZodError?t.cause.flatten():null}})}),h=m.middleware(async({path:e,next:t,ctx:r})=>{let n={correlationId:r.correlationId,userId:r.session?.user?.id,sessionId:r.session?.user?.email||void 0},a={...n,journey:e,startTime:Date.now()};d.kg.info(`tRPC request started: ${e}`,n,{path:e,hasSession:!!r.session});try{let s=await (0,u.Mf)(a,()=>t({ctx:r})),o=Date.now()-a.startTime;return d.kg.info(`tRPC request completed: ${e}`,n,{path:e,duration:o,success:!0}),s}catch(r){let t=Date.now()-a.startTime;throw d.kg.error(`tRPC request failed: ${e}`,n,r instanceof Error?r:Error("Unknown error"),{path:e,duration:t,errorType:r instanceof s.TRPCError?r.code:"UNKNOWN"}),r}}),A=m.router,D=m.procedure.use(h);m.procedure.use(h).use(({ctx:e,next:t})=>{if(!e.session||!e.session.user)throw new s.TRPCError({code:"UNAUTHORIZED"});return t({ctx:{session:{...e.session,user:e.session.user}}})}),n()}catch(e){n(e)}})},1001:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{WG:()=>l,handlers:()=>u});var s=r(3735),a=r(9551),o=r(3288),i=r(5386),c=r(105),d=e([s,a,o,i,c]);[s,a,o,i,c]=d.then?(await d)():d;let{handlers:u,auth:l,signIn:p,signOut:E}=(0,s.default)({callbacks:{session:({session:e,user:t})=>({...e,user:{...e.user,id:t.id}})},adapter:(0,o.PrismaAdapter)(c.db),providers:[(0,a.default)({clientId:i.O.DISCORD_CLIENT_ID??"",clientSecret:i.O.DISCORD_CLIENT_SECRET??""})]});n()}catch(e){n(e)}})},105:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{db:()=>c});var s=r(3524),a=r(5386),o=e([a]);a=(o.then?(await o)():o)[0];let i=globalThis,c=i.prisma??new s.PrismaClient({log:"development"===a.O.NODE_ENV?["query","error","warn"]:["error"]});"production"!==a.O.NODE_ENV&&(i.prisma=c),n()}catch(e){n(e)}})},6629:(e,t,r)=>{r.d(t,{kg:()=>a});let n=[{pattern:/([a-zA-Z0-9._%+-]+)@([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g,replacement:"[REDACTED_EMAIL]"},{pattern:/(\+?61|0)[2-9]\d{8}/g,replacement:"[REDACTED_PHONE]"},{pattern:/\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/g,replacement:"[REDACTED_CC]"},{pattern:/\b\d{3}[\s-]?\d{3}[\s-]?\d{3}\b/g,replacement:"[REDACTED_TFN]"},{pattern:/"((?:[\w.]+\.)?(?:name|firstName|lastName|fullName))"\s*:\s*"[^"]+"/gi,replacement:(e,t)=>`"${t}":"[REDACTED_NAME]"`},{pattern:/\d+\s+[\w\s]+\s+(Street|St|Avenue|Ave|Road|Rd|Drive|Dr|Court|Ct|Lane|Ln)/gi,replacement:"[REDACTED_ADDRESS]"},{pattern:/"(api[_-]?key|apiKey|token|secret|password)"\s*:\s*"[^"]+"/gi,replacement:(e,t)=>`"${t}":"[REDACTED]"`}];class s{constructor(e="production",t="holiday-aggregator"){this.environment=e,this.service=t}scrubPII(e){if(!e)return e;let t=JSON.stringify(e);for(let{pattern:e,replacement:r}of n)t=t.replace(e,r);try{return JSON.parse(t)}catch{return console.warn("Failed to parse scrubbed data, returning original"),e}}createLogEntry(e,t,r,n,s){let a={timestamp:new Date().toISOString(),level:e,message:t,context:{...r,environment:this.environment,service:this.service}};return n&&(a.data=this.scrubPII(n)),s&&(a.error={name:s.name,message:s.message,stack:"development"===this.environment||"test"===this.environment?s.stack:void 0}),a}output(e){let t=JSON.stringify(e);switch(e.level){case"debug":"development"===this.environment&&console.debug(t);break;case"info":console.info(t);break;case"warn":console.warn(t);break;case"error":console.error(t)}}debug(e,t,r){let n=this.createLogEntry("debug",e,t,r);this.output(n)}info(e,t,r){let n=this.createLogEntry("info",e,t,r);this.output(n)}warn(e,t,r){let n=this.createLogEntry("warn",e,t,r);this.output(n)}error(e,t,r,n){let s=this.createLogEntry("error",e,t,n,r);this.output(s)}}let a=new s},6336:(e,t,r)=>{r.d(t,{Mf:()=>s});let n=new(require("node:async_hooks")).AsyncLocalStorage;function s(e,t){return n.run(e,t)}},5637:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},415:(e,t,r)=>{e.exports=r(145)},5386:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{O:()=>i});var s=r(6206),a=r(9926),o=e([s,a]);[s,a]=o.then?(await o)():o;let i=(0,s.createEnv)({server:{DATABASE_URL:a.z.string().url().refine(e=>!e.includes("YOUR_MYSQL_URL_HERE"),"You forgot to change the default URL"),NODE_ENV:a.z.enum(["development","test","production"]).default("development"),NEXTAUTH_SECRET:a.z.string().min(1),NEXTAUTH_URL:a.z.preprocess(e=>process.env.VERCEL_URL??e,process.env.VERCEL?a.z.string().min(1):a.z.string().url()),DISCORD_CLIENT_ID:a.z.string().optional(),DISCORD_CLIENT_SECRET:a.z.string().optional()},client:{},runtimeEnv:{DATABASE_URL:process.env.DATABASE_URL,NODE_ENV:"production",NEXTAUTH_SECRET:process.env.NEXTAUTH_SECRET,NEXTAUTH_URL:process.env.NEXTAUTH_URL,DISCORD_CLIENT_ID:process.env.DISCORD_CLIENT_ID,DISCORD_CLIENT_SECRET:process.env.DISCORD_CLIENT_SECRET},skipValidation:!!process.env.SKIP_ENV_VALIDATION,emptyStringAsUndefined:!0});n()}catch(e){n(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6010);module.exports=r})();