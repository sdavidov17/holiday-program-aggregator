
> web@0.1.0 test /Users/sergei.davidov@clearroute.io/Documents/holiday-program-aggregator/apps/web
> jest --passWithNoTests

PASS src/__tests__/helpers/test-context.ts
PASS src/__tests__/api/stripe/webhook.test.ts
  ● Console

    console.info
      {"timestamp":"2025-08-13T06:40:45.749Z","level":"info","message":"Checkout session completed","context":{"correlationId":"unknown","sessionId":"cs_test_123","userId":"user123","environment":"test","service":"holiday-aggregator"}}

      at StructuredLogger.output (src/utils/logger.ts:139:17)

    console.error
      {"timestamp":"2025-08-13T06:40:45.769Z","level":"error","message":"No userId in session metadata","context":{"correlationId":"unknown","sessionId":"cs_test_123","environment":"test","service":"holiday-aggregator"}}

      89 |       !args[0]?.includes?.('Invalid token')
      90 |     ) {
    > 91 |       originalError(...args);
         |       ^
      92 |     }
      93 |   });
      94 | });

      at console.<anonymous> (jest.setup.ts:91:7)
      at StructuredLogger.output (src/utils/logger.ts:145:17)
      at StructuredLogger.error (src/utils/logger.ts:167:10)
      at handler (src/pages/api/stripe/webhook.ts:61:18)
      at Object.<anonymous> (src/__tests__/api/stripe/webhook.test.ts:134:7)

    console.info
      {"timestamp":"2025-08-13T06:40:45.771Z","level":"info","message":"Subscription updated","context":{"correlationId":"unknown","subscriptionId":"sub_test_123","status":"active","environment":"test","service":"holiday-aggregator"}}

      at StructuredLogger.output (src/utils/logger.ts:139:17)

    console.info
      {"timestamp":"2025-08-13T06:40:45.771Z","level":"info","message":"Subscription updated","context":{"correlationId":"unknown","subscriptionId":"sub_test_123","status":"past_due","environment":"test","service":"holiday-aggregator"}}

      at StructuredLogger.output (src/utils/logger.ts:139:17)

    console.info
      {"timestamp":"2025-08-13T06:40:45.772Z","level":"info","message":"Subscription deleted","context":{"correlationId":"unknown","subscriptionId":"sub_test_123","environment":"test","service":"holiday-aggregator"}}

      at StructuredLogger.output (src/utils/logger.ts:139:17)

    console.info
      {"timestamp":"2025-08-13T06:40:45.772Z","level":"info","message":"Invoice payment succeeded","context":{"correlationId":"unknown","invoiceId":"in_test_123","subscriptionId":"sub_test_123","environment":"test","service":"holiday-aggregator"}}

      at StructuredLogger.output (src/utils/logger.ts:139:17)

    console.warn
      {"timestamp":"2025-08-13T06:40:45.773Z","level":"warn","message":"Invoice payment failed","context":{"correlationId":"unknown","invoiceId":"in_test_123","subscriptionId":"sub_test_123","environment":"test","service":"holiday-aggregator"}}

      140 |         break;
      141 |       case 'warn':
    > 142 |         console.warn(json);
          |                 ^
      143 |         break;
      144 |       case 'error':
      145 |         console.error(json);

      at StructuredLogger.output (src/utils/logger.ts:142:17)
      at StructuredLogger.warn (src/utils/logger.ts:162:10)
      at handler (src/pages/api/stripe/webhook.ts:181:16)
      at Object.<anonymous> (src/__tests__/api/stripe/webhook.test.ts:336:7)

    console.info
      {"timestamp":"2025-08-13T06:40:45.773Z","level":"info","message":"Unhandled webhook event","context":{"correlationId":"unknown","eventType":"some.unknown.event","environment":"test","service":"holiday-aggregator"}}

      at StructuredLogger.output (src/utils/logger.ts:139:17)

    console.error
      {"timestamp":"2025-08-13T06:40:45.773Z","level":"error","message":"Webhook signature verification failed","context":{"correlationId":"unknown","error":{},"environment":"test","service":"holiday-aggregator"}}

      89 |       !args[0]?.includes?.('Invalid token')
      90 |     ) {
    > 91 |       originalError(...args);
         |       ^
      92 |     }
      93 |   });
      94 | });

      at console.<anonymous> (jest.setup.ts:91:7)
      at StructuredLogger.output (src/utils/logger.ts:145:17)
      at StructuredLogger.error (src/utils/logger.ts:167:10)
      at handler (src/pages/api/stripe/webhook.ts:51:12)
      at Object.<anonymous> (src/__tests__/api/stripe/webhook.test.ts:386:5)

    console.error
      {"timestamp":"2025-08-13T06:40:45.773Z","level":"error","message":"Error processing webhook","context":{"correlationId":"unknown","error":{},"environment":"test","service":"holiday-aggregator"}}

      89 |       !args[0]?.includes?.('Invalid token')
      90 |     ) {
    > 91 |       originalError(...args);
         |       ^
      92 |     }
      93 |   });
      94 | });

      at console.<anonymous> (jest.setup.ts:91:7)
      at StructuredLogger.output (src/utils/logger.ts:145:17)
      at StructuredLogger.error (src/utils/logger.ts:167:10)
      at handler (src/pages/api/stripe/webhook.ts:191:12)
      at Object.<anonymous> (src/__tests__/api/stripe/webhook.test.ts:415:5)

PASS src/components/__tests__/PremiumFeatureGuard.test.tsx
